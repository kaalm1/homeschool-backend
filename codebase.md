# .gitignore

```
.venv/
__pycache__/
*.pyc
app.db
.env
.env.example
.idea/
```

# .idea/.gitignore

```
# Default ignored files
/shelf/
/workspace.xml

```

# .idea/homeschool-backend.iml

```iml
<?xml version="1.0" encoding="UTF-8"?>
<module type="PYTHON_MODULE" version="4">
  <component name="NewModuleRootManager">
    <content url="file://$MODULE_DIR$">
      <excludeFolder url="file://$MODULE_DIR$/.venv" />
    </content>
    <orderEntry type="jdk" jdkName="Python 3.12 (homeschool-backend)" jdkType="Python SDK" />
    <orderEntry type="sourceFolder" forTests="false" />
  </component>
</module>
```

# .idea/inspectionProfiles/profiles_settings.xml

```xml
<component name="InspectionProjectProfileManager">
  <settings>
    <option name="USE_PROJECT_PROFILE" value="false" />
    <version value="1.0" />
  </settings>
</component>
```

# .idea/misc.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="Black">
    <option name="sdkName" value="Python 3.12 (homeschool-backend)" />
  </component>
  <component name="ProjectRootManager" version="2" project-jdk-name="Python 3.12 (homeschool-backend)" project-jdk-type="Python SDK" />
</project>
```

# .idea/modules.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="ProjectModuleManager">
    <modules>
      <module fileurl="file://$PROJECT_DIR$/.idea/homeschool-backend.iml" filepath="$PROJECT_DIR$/.idea/homeschool-backend.iml" />
    </modules>
  </component>
</project>
```

# .idea/vcs.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="VcsDirectoryMappings">
    <mapping directory="$PROJECT_DIR$" vcs="Git" />
  </component>
</project>
```

# .idea/workspace.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="AutoImportSettings">
    <option name="autoReloadType" value="SELECTIVE" />
  </component>
  <component name="ChangeListManager">
    <list default="true" id="5341e103-a4db-4662-ae77-b42840c14939" name="Changes" comment="" />
    <option name="SHOW_DIALOG" value="false" />
    <option name="HIGHLIGHT_CONFLICTS" value="true" />
    <option name="HIGHLIGHT_NON_ACTIVE_CHANGELIST" value="false" />
    <option name="LAST_RESOLUTION" value="IGNORE" />
  </component>
  <component name="FileTemplateManagerImpl">
    <option name="RECENT_TEMPLATES">
      <list>
        <option value="Python Script" />
      </list>
    </option>
  </component>
  <component name="Git.Settings">
    <option name="RECENT_GIT_ROOT_PATH" value="$PROJECT_DIR$" />
  </component>
  <component name="GitHubPullRequestSearchHistory"><![CDATA[{
  "lastFilter": {
    "state": "OPEN",
    "assignee": "kaalm1"
  }
}]]></component>
  <component name="GithubPullRequestsUISettings"><![CDATA[{
  "selectedUrlAndAccountId": {
    "url": "git@github.com:kaalm1/homeschool-backend.git",
    "accountId": "8f8baeb5-1bcb-4bfd-967d-cf88253012b2"
  }
}]]></component>
  <component name="ProjectColorInfo"><![CDATA[{
  "associatedIndex": 6
}]]></component>
  <component name="ProjectId" id="31mu94SOo1vXvzL8AF2qleJchVH" />
  <component name="ProjectViewState">
    <option name="hideEmptyMiddlePackages" value="true" />
    <option name="showLibraryContents" value="true" />
  </component>
  <component name="PropertiesComponent"><![CDATA[{
  "keyToString": {
    "ModuleVcsDetector.initialDetectionPerformed": "true",
    "RunOnceActivity.ShowReadmeOnStart": "true",
    "git-widget-placeholder": "main",
    "last_opened_file_path": "/Users/joe/git/homeschool-backend/app"
  }
}]]></component>
  <component name="RecentsManager">
    <key name="CopyFile.RECENT_KEYS">
      <recent name="$PROJECT_DIR$/app" />
      <recent name="$PROJECT_DIR$/app/routers" />
    </key>
  </component>
  <component name="RunManager">
    <configuration name="main" type="PythonConfigurationType" factoryName="Python" nameIsGenerated="true">
      <module name="homeschool-backend" />
      <option name="ENV_FILES" value="" />
      <option name="INTERPRETER_OPTIONS" value="" />
      <option name="PARENT_ENVS" value="true" />
      <envs>
        <env name="PYTHONUNBUFFERED" value="1" />
      </envs>
      <option name="SDK_HOME" value="" />
      <option name="WORKING_DIRECTORY" value="$PROJECT_DIR$" />
      <option name="IS_MODULE_SDK" value="true" />
      <option name="ADD_CONTENT_ROOTS" value="true" />
      <option name="ADD_SOURCE_ROOTS" value="true" />
      <option name="SCRIPT_NAME" value="$PROJECT_DIR$/main.py" />
      <option name="PARAMETERS" value="" />
      <option name="SHOW_COMMAND_LINE" value="false" />
      <option name="EMULATE_TERMINAL" value="false" />
      <option name="MODULE_MODE" value="false" />
      <option name="REDIRECT_INPUT" value="false" />
      <option name="INPUT_FILE" value="" />
      <method v="2" />
    </configuration>
  </component>
  <component name="SharedIndexes">
    <attachedChunks>
      <set>
        <option value="bundled-python-sdk-9f8e2b94138c-36ea0e71a18c-com.jetbrains.pycharm.pro.sharedIndexes.bundled-PY-251.26094.141" />
      </set>
    </attachedChunks>
  </component>
  <component name="TaskManager">
    <task active="true" id="Default" summary="Default task">
      <changelist id="5341e103-a4db-4662-ae77-b42840c14939" name="Changes" comment="" />
      <created>1756141415566</created>
      <option name="number" value="Default" />
      <option name="presentableId" value="Default" />
      <updated>1756141415566</updated>
    </task>
    <servers />
  </component>
  <component name="XDebuggerManager">
    <breakpoint-manager>
      <breakpoints>
        <line-breakpoint enabled="true" suspend="THREAD" type="python-line">
          <url>file://$PROJECT_DIR$/main.py</url>
          <line>8</line>
          <option name="timeStamp" value="1" />
        </line-breakpoint>
      </breakpoints>
    </breakpoint-manager>
  </component>
</project>
```

# alembic.ini

```ini
# A generic, single database configuration.

[alembic]
# path to migration scripts.
# this is typically a path given in POSIX (e.g. forward slashes)
# format, relative to the token %(here)s which refers to the location of this
# ini file
script_location = %(here)s/alembic

# template used to generate migration file names; The default value is %%(rev)s_%%(slug)s
# Uncomment the line below if you want the files to be prepended with date and time
# see https://alembic.sqlalchemy.org/en/latest/tutorial.html#editing-the-ini-file
# for all available tokens
# file_template = %%(year)d_%%(month).2d_%%(day).2d_%%(hour).2d%%(minute).2d-%%(rev)s_%%(slug)s

# sys.path path, will be prepended to sys.path if present.
# defaults to the current working directory.  for multiple paths, the path separator
# is defined by "path_separator" below.
prepend_sys_path = .


# timezone to use when rendering the date within the migration file
# as well as the filename.
# If specified, requires the python>=3.9 or backports.zoneinfo library and tzdata library.
# Any required deps can installed by adding `alembic[tz]` to the pip requirements
# string value is passed to ZoneInfo()
# leave blank for localtime
# timezone =

# max length of characters to apply to the "slug" field
# truncate_slug_length = 40

# set to 'true' to run the environment during
# the 'revision' command, regardless of autogenerate
# revision_environment = false

# set to 'true' to allow .pyc and .pyo files without
# a source .py file to be detected as revisions in the
# versions/ directory
# sourceless = false

# version location specification; This defaults
# to <script_location>/versions.  When using multiple version
# directories, initial revisions must be specified with --version-path.
# The path separator used here should be the separator specified by "path_separator"
# below.
# version_locations = %(here)s/bar:%(here)s/bat:%(here)s/alembic/versions

# path_separator; This indicates what character is used to split lists of file
# paths, including version_locations and prepend_sys_path within configparser
# files such as alembic.ini.
# The default rendered in new alembic.ini files is "os", which uses os.pathsep
# to provide os-dependent path splitting.
#
# Note that in order to support legacy alembic.ini files, this default does NOT
# take place if path_separator is not present in alembic.ini.  If this
# option is omitted entirely, fallback logic is as follows:
#
# 1. Parsing of the version_locations option falls back to using the legacy
#    "version_path_separator" key, which if absent then falls back to the legacy
#    behavior of splitting on spaces and/or commas.
# 2. Parsing of the prepend_sys_path option falls back to the legacy
#    behavior of splitting on spaces, commas, or colons.
#
# Valid values for path_separator are:
#
# path_separator = :
# path_separator = ;
# path_separator = space
# path_separator = newline
#
# Use os.pathsep. Default configuration used for new projects.
path_separator = os

# set to 'true' to search source files recursively
# in each "version_locations" directory
# new in Alembic version 1.10
# recursive_version_locations = false

# the output encoding used when revision files
# are written from script.py.mako
# output_encoding = utf-8

# database URL.  This is consumed by the user-maintained env.py script only.
# other means of configuring database URLs may be customized within the env.py
# file.
;sqlalchemy.url = driver://user:pass@localhost/dbname
sqlalchemy.url = postgresql+psycopg2://username:password@localhost:5432/homeschool_db


[post_write_hooks]
# post_write_hooks defines scripts or Python functions that are run
# on newly generated revision scripts.  See the documentation for further
# detail and examples

# format using "black" - use the console_scripts runner, against the "black" entrypoint
# hooks = black
# black.type = console_scripts
# black.entrypoint = black
# black.options = -l 79 REVISION_SCRIPT_FILENAME

# lint with attempts to fix using "ruff" - use the module runner, against the "ruff" module
# hooks = ruff
# ruff.type = module
# ruff.module = ruff
# ruff.options = check --fix REVISION_SCRIPT_FILENAME

# Alternatively, use the exec runner to execute a binary found on your PATH
# hooks = ruff
# ruff.type = exec
# ruff.executable = ruff
# ruff.options = check --fix REVISION_SCRIPT_FILENAME

# Logging configuration.  This is also consumed by the user-maintained
# env.py script only.
[loggers]
keys = root,sqlalchemy,alembic

[handlers]
keys = console

[formatters]
keys = generic

[logger_root]
level = WARNING
handlers = console
qualname =

[logger_sqlalchemy]
level = WARNING
handlers =
qualname = sqlalchemy.engine

[logger_alembic]
level = INFO
handlers =
qualname = alembic

[handler_console]
class = StreamHandler
args = (sys.stderr,)
level = NOTSET
formatter = generic

[formatter_generic]
format = %(levelname)-5.5s [%(name)s] %(message)s
datefmt = %H:%M:%S

```

# alembic/env.py

```py
from logging.config import fileConfig

from sqlalchemy import engine_from_config
from sqlalchemy import pool

from alembic import context

# this is the Alembic Config object, which provides
# access to the values within the .ini file in use.
config = context.config

# Interpret the config file for Python logging.
# This line sets up loggers basically.
if config.config_file_name is not None:
    fileConfig(config.config_file_name)

# add your model's MetaData object here
# for 'autogenerate' support
# from myapp import mymodel
# target_metadata = mymodel.Base.metadata
target_metadata = None

# other values from the config, defined by the needs of env.py,
# can be acquired:
# my_important_option = config.get_main_option("my_important_option")
# ... etc.


def run_migrations_offline() -> None:
    """Run migrations in 'offline' mode.

    This configures the context with just a URL
    and not an Engine, though an Engine is acceptable
    here as well.  By skipping the Engine creation
    we don't even need a DBAPI to be available.

    Calls to context.execute() here emit the given string to the
    script output.

    """
    url = config.get_main_option("sqlalchemy.url")
    context.configure(
        url=url,
        target_metadata=target_metadata,
        literal_binds=True,
        dialect_opts={"paramstyle": "named"},
    )

    with context.begin_transaction():
        context.run_migrations()


def run_migrations_online() -> None:
    """Run migrations in 'online' mode.

    In this scenario we need to create an Engine
    and associate a connection with the context.

    """
    connectable = engine_from_config(
        config.get_section(config.config_ini_section, {}),
        prefix="sqlalchemy.",
        poolclass=pool.NullPool,
    )

    with connectable.connect() as connection:
        context.configure(
            connection=connection, target_metadata=target_metadata
        )

        with context.begin_transaction():
            context.run_migrations()


if context.is_offline_mode():
    run_migrations_offline()
else:
    run_migrations_online()

```

# alembic/README

```
Generic single-database configuration.
```

# alembic/script.py.mako

```mako
"""${message}

Revision ID: ${up_revision}
Revises: ${down_revision | comma,n}
Create Date: ${create_date}

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
${imports if imports else ""}

# revision identifiers, used by Alembic.
revision: str = ${repr(up_revision)}
down_revision: Union[str, Sequence[str], None] = ${repr(down_revision)}
branch_labels: Union[str, Sequence[str], None] = ${repr(branch_labels)}
depends_on: Union[str, Sequence[str], None] = ${repr(depends_on)}


def upgrade() -> None:
    """Upgrade schema."""
    ${upgrades if upgrades else "pass"}


def downgrade() -> None:
    """Downgrade schema."""
    ${downgrades if downgrades else "pass"}

```

# app/__init__.py

```py

```

# app/main.py

```py

from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from .routers import auth, kids, schedule, rewards, activities
from .settings import settings
from svc.app.models.base import Base, engine
from svc.app.scripts.seed import seed_demo

app = FastAPI(title="Homeschool Helper API")

origins = [o.strip() for o in settings.CORS_ORIGINS.split(",")]
app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)


@app.on_event("startup")
def on_startup():
    Base.metadata.create_all(bind=engine)
    seed_demo()


app.include_router(auth.router, prefix="/auth", tags=["auth"])
app.include_router(kids.router, prefix="/kids", tags=["kids"])
app.include_router(schedule.router, prefix="/schedule", tags=["schedule"])
app.include_router(rewards.router, prefix="/rewards", tags=["rewards"])
app.include_router(activities.router, prefix="/activities", tags=["activities"])


@app.get("/")
def root():
    return {"status": "ok"}

```

# app/models/activity.py

```py
from sqlalchemy import Integer, String, Column, Boolean, ForeignKey
from sqlalchemy.orm import relationship
from svc.app.models.base import Base


class Activity(Base):
    __tablename__ = "activities"
    id = Column(Integer, primary_key=True, index=True)
    title = Column(String, nullable=False)
    subject = Column(String, default="General")
    done = Column(Boolean, default=False)
    kid_id = Column(Integer, ForeignKey("kids.id"), nullable=False)

    kid = relationship("Kid", back_populates="activities")

```

# app/models/base.py

```py
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker, DeclarativeBase
from ..settings import settings

engine = create_engine(settings.DATABASE_URL, echo=True, future=True)
SessionLocal = sessionmaker(bind=engine, autoflush=False, autocommit=False, future=True)

class Base(DeclarativeBase):
    pass

```

# app/models/kid.py

```py
from sqlalchemy import Integer, String, Column, ForeignKey
from sqlalchemy.orm import relationship
from svc.app.models.base import Base


class Kid(Base):
    __tablename__ = "kids"
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String, nullable=False)
    color = Column(String, default="#a7f3d0")
    parent_id = Column(Integer, ForeignKey("users.id"), nullable=False)

    parent = relationship("User", back_populates="kids")
    activities = relationship("Activity", back_populates="kid")

```

# app/models/user.py

```py
from sqlalchemy import Integer, String, Column
from sqlalchemy.orm import relationship
from svc.app.models.base import Base


class User(Base):
    __tablename__ = "users"
    id = Column(Integer, primary_key=True, index=True)
    email = Column(String, unique=True, index=True, nullable=False)
    password_hash = Column(String, nullable=False)

    kids = relationship("Kid", back_populates="parent")

```

# app/routers/__init__.py

```py

```

# app/routers/activities.py

```py
from fastapi import APIRouter, Depends, HTTPException
from pydantic import BaseModel
from sqlalchemy.orm import Session
from typing import List

from svc.app.models.base import SessionLocal
from svc.app.models.activity import Activity
from svc.app.models.kid import Kid
from svc.app.utils.security import get_current_user

router = APIRouter()


# -------------------
# Pydantic Schemas
# -------------------

class ActivityCreate(BaseModel):
    title: str
    subject: str
    kid_id: int


class ActivityUpdate(BaseModel):
    title: str | None = None
    subject: str | None = None
    done: bool | None = None


class ActivityOut(BaseModel):
    id: int
    title: str
    subject: str
    done: bool
    kid_id: int

    class Config:
        from_attributes = True


# -------------------
# DB dependency
# -------------------

def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()


# -------------------
# Routes
# -------------------

@router.get("", response_model=List[ActivityOut])
def list_activities(user=Depends(get_current_user), db: Session = Depends(get_db)):
    """
    List all activities for all kids of the current parent
    """
    activities = db.query(Activity).join(Kid).filter(Kid.parent_id == user.id).all()
    return activities


@router.post("", response_model=ActivityOut)
def create_activity(data: ActivityCreate, user=Depends(get_current_user), db: Session = Depends(get_db)):
    """
    Create a new activity for a kid
    """
    kid = db.query(Kid).filter(Kid.id == data.kid_id, Kid.parent_id == user.id).first()
    if not kid:
        raise HTTPException(status_code=404, detail="Kid not found")

    activity = Activity(title=data.title, subject=data.subject, kid_id=kid.id)
    db.add(activity)
    db.commit()
    db.refresh(activity)
    return activity


@router.patch("/{activity_id}", response_model=ActivityOut)
def update_activity(activity_id: int, data: ActivityUpdate, user=Depends(get_current_user),
                    db: Session = Depends(get_db)):
    """
    Update an activity (title, subject, done)
    """
    activity = db.query(Activity).join(Kid).filter(Activity.id == activity_id, Kid.parent_id == user.id).first()
    if not activity:
        raise HTTPException(status_code=404, detail="Activity not found")

    if data.title is not None:
        activity.title = data.title
    if data.subject is not None:
        activity.subject = data.subject
    if data.done is not None:
        activity.done = data.done

    db.commit()
    db.refresh(activity)
    return activity


@router.delete("/{activity_id}", response_model=dict)
def delete_activity(activity_id: int, user=Depends(get_current_user), db: Session = Depends(get_db)):
    """
    Delete an activity
    """
    activity = db.query(Activity).join(Kid).filter(Activity.id == activity_id, Kid.parent_id == user.id).first()
    if not activity:
        raise HTTPException(status_code=404, detail="Activity not found")

    db.delete(activity)
    db.commit()
    return {"detail": "Activity deleted"}

```

# app/routers/auth.py

```py

from fastapi import APIRouter, Depends, HTTPException
from pydantic import BaseModel, EmailStr
from sqlalchemy import select
from sqlalchemy.orm import Session
from svc.app import User
from ..security import create_access_token, verify_password, get_db
from passlib.hash import bcrypt

router = APIRouter()


class LoginIn(BaseModel):
    email: EmailStr
    password: str


class TokenOut(BaseModel):
    access_token: str
    token_type: str = "bearer"


@router.post("/login", response_model=TokenOut)
def login(data: LoginIn, db: Session = Depends(get_db)):
    user = db.execute(select(User).where(User.email == data.email)).scalar_one_or_none()
    if not user or not verify_password(data.password, user.password_hash):
        raise HTTPException(status_code=401, detail="Invalid credentials")
    token = create_access_token(user.email)
    return TokenOut(access_token=token)


class RegisterIn(BaseModel):
    email: EmailStr
    password: str


@router.post("/register", response_model=TokenOut)
def register(data: RegisterIn, db: Session = Depends(get_db)):
    if db.execute(select(User).where(User.email == data.email)).scalar_one_or_none():
        raise HTTPException(status_code=400, detail="Email already registered")
    user = User(email=data.email, password_hash=bcrypt.hash(data.password))
    db.add(user);
    db.commit()
    token = create_access_token(user.email)
    return TokenOut(access_token=token)

```

# app/routers/kids.py

```py

from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from sqlalchemy import select
from pydantic import BaseModel
from svc.app.models.kid import Kid
from ..security import get_current_user, get_db

router = APIRouter()


class KidOut(BaseModel):
    id: int
    name: str
    color: str

    class Config:
        from_attributes = True


@router.get("", response_model=list[KidOut])
def list_kids(user=Depends(get_current_user), db: Session = Depends(get_db)):
    rows = db.execute(select(Kid).where(Kid.parent_id == user.id)).scalars().all()
    return rows

```

# app/routers/rewards.py

```py

from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from sqlalchemy import select, func
from pydantic import BaseModel
from svc.app.models.activity import Activity
from svc.app.models.kid import Kid
from ..security import get_current_user, get_db

router = APIRouter()


class RewardSummary(BaseModel):
    kid_id: int
    kid_name: str
    stars: int


@router.get("/summary", response_model=list[RewardSummary])
def reward_summary(user=Depends(get_current_user), db: Session = Depends(get_db)):
    # Simple: stars = number of done activities
    kids = db.execute(select(Kid).where(Kid.parent_id == user.id)).scalars().all()
    res: list[RewardSummary] = []
    for k in kids:
        count = db.execute(select(func.count()).select_from(Activity).where(Activity.kid_id == k.id,
                                                                            Activity.done == True)).scalar() or 0
        res.append(RewardSummary(kid_id=k.id, kid_name=k.name, stars=int(count)))
    return res

```

# app/routers/schedule.py

```py

from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.orm import Session
from sqlalchemy import select
from pydantic import BaseModel
from svc.app.models.activity import Activity
from svc.app.models.kid import Kid
from ..security import get_current_user, get_db

router = APIRouter()


class ActivityOut(BaseModel):
    id: int
    title: str
    subject: str
    kid_id: int
    done: bool

    class Config:
        from_attributes = True


class ActivityIn(BaseModel):
    title: str
    subject: str = "General"
    kid_id: int


@router.get("/today", response_model=list[ActivityOut])
def today(user=Depends(get_current_user), db: Session = Depends(get_db)):
    # MVP: return all activities for the user's kids (no date dimension yet)
    kid_ids = [k.id for k in db.execute(select(Kid).where(Kid.parent_id == user.id)).scalars().all()]
    rows = db.execute(select(Activity).where(Activity.kid_id.in_(kid_ids))).scalars().all()
    return rows


@router.post("/add", response_model=ActivityOut)
def add_activity(data: ActivityIn, user=Depends(get_current_user), db: Session = Depends(get_db)):
    kid = db.get(Kid, data.kid_id)
    if not kid or kid.parent_id != user.id:
        raise HTTPException(status_code=404, detail="Kid not found")
    a = Activity(title=data.title, subject=data.subject, kid_id=data.kid_id)
    db.add(a);
    db.commit();
    db.refresh(a)
    return a


class ToggleIn(BaseModel):
    id: int


@router.post("/toggle", response_model=ActivityOut)
def toggle(data: ToggleIn, user=Depends(get_current_user), db: Session = Depends(get_db)):
    a = db.get(Activity, data.id)
    if not a:
        raise HTTPException(status_code=404, detail="Activity not found")
    # security: ensure activity belongs to current user
    if a.kid.parent_id != user.id:
        raise HTTPException(status_code=403, detail="Forbidden")
    a.done = not a.done
    db.add(a);
    db.commit();
    db.refresh(a)
    return a

```

# app/scripts/__init__.py

```py

```

# app/scripts/seed.py

```py
from svc.app.models.base import SessionLocal
from svc.app import User
from svc.app.models.kid import Kid
from svc.app.models.activity import Activity
from passlib.hash import bcrypt
from sqlalchemy import select


def seed_demo():
    db = SessionLocal()
    try:
        if not db.execute(select(User).where(User.email == "demo@home.school")).scalar_one_or_none():
            user = User(email="demo@home.school", password_hash=bcrypt.hash("demo123"))
            db.add(user);
            db.flush()
            kid1 = Kid(name="Ava", color="#fde68a", parent_id=user.id)
            kid2 = Kid(name="Ben", color="#93c5fd", parent_id=user.id)
            db.add_all([kid1, kid2]);
            db.flush()
            db.add_all([
                Activity(title="Read 10 minutes", subject="Reading", kid_id=kid1.id),
                Activity(title="Count to 50", subject="Math", kid_id=kid1.id),
                Activity(title="Leaf hunt outside", subject="Science", kid_id=kid2.id),
            ])
            db.commit()
    finally:
        db.close()

```

# app/security.py

```py

from datetime import datetime, timedelta, timezone
from jose import jwt, JWTError
from passlib.hash import bcrypt
from fastapi import HTTPException, Depends
from fastapi.security import HTTPAuthorizationCredentials, HTTPBearer
from .settings import settings
from svc.app.models.base import SessionLocal
from svc.app import User
from sqlalchemy import select

bearer = HTTPBearer(auto_error=False)


def create_access_token(subject: str, expires_minutes: int | None = None) -> str:
    expire = datetime.now(timezone.utc) + timedelta(minutes=expires_minutes or settings.ACCESS_TOKEN_EXPIRE_MINUTES)
    to_encode = {"sub": subject, "exp": expire}
    return jwt.encode(to_encode, settings.SECRET_KEY, algorithm="HS256")


def verify_password(plain: str, hashed: str) -> bool:
    return bcrypt.verify(plain, hashed)


def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()


def get_current_user(credentials: HTTPAuthorizationCredentials = Depends(bearer), db=Depends(get_db)) -> User:
    if not credentials:
        raise HTTPException(status_code=401, detail="Not authenticated")
    token = credentials.credentials
    try:
        payload = jwt.decode(token, settings.SECRET_KEY, algorithms=["HS256"])
        email = payload.get("sub")
        if email is None:
            raise HTTPException(status_code=401, detail="Invalid token")
    except JWTError:
        raise HTTPException(status_code=401, detail="Invalid token")
    user = db.execute(select(User).where(User.email == email)).scalar_one_or_none()
    if not user:
        raise HTTPException(status_code=401, detail="User not found")
    return user

```

# app/settings.py

```py

from pydantic_settings import BaseSettings, SettingsConfigDict

class Settings(BaseSettings):
    SECRET_KEY: str = "change_me"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 60 * 24 * 30
    DATABASE_URL: str = "sqlite:///./app.db"
    CORS_ORIGINS: str = "http://localhost:5173"

    model_config = SettingsConfigDict(env_file=".env", env_file_encoding="utf-8")

settings = Settings()

```

# main.py

```py
# This is a sample Python script.

# Press ⌃R to execute it or replace it with your code.
# Press Double ⇧ to search everywhere for classes, files, tool windows, actions, and settings.


def print_hi(name):
    # Use a breakpoint in the code line below to debug your script.
    print(f'Hi, {name}')  # Press ⌘F8 to toggle the breakpoint.


# Press the green button in the gutter to run the script.
if __name__ == '__main__':
    print_hi('PyCharm')

# See PyCharm help at https://www.jetbrains.com/help/pycharm/

```

# README.md

```md
# Homeschool Backend (FastAPI)

- Auth: JWT (demo user auto-seeded)
- DB: SQLite (upgrade to Postgres later)
- CORS: allows http://localhost:5173

## Quick start
\`\`\`bash
python -m venv .venv && source .venv/bin/activate
pip install -r requirements.txt
cp .env.example .env
uvicorn app.main:app --reload

```

# requirements.txt

```txt
fastapi==0.115.0
uvicorn[standard]==0.30.6
python-multipart==0.0.9
passlib[bcrypt]==1.7.4
python-jose==3.3.0
SQLAlchemy==2.0.34
pydantic==2.9.0
pydantic-settings==2.5.2
```

